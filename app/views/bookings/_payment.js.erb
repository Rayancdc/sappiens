var button = document.querySelector('button');

// Abrir o modal ao clicar no botão
button.addEventListener('click', function() {

  // inicia a instância do checkout
  var checkout = new PagarMeCheckout.Checkout({
    encryption_key: 'SUA ENCRYPTION KEY',
    success: function(payment_data) {
      console.log(payment_data);
      Rails.ajax({
        url: "/experiences/<%= params[:experience_id] %>/events/<%=  params[:event_id] %>/bookings",
        dataType: "json",
        type: "POST",
        success: function(data) {
          window.location.href = `/bookings/${data.booking_id}`
        },
        error: function(data) {
          console.log(data.errors)
        }
      })
    },
    error: function(err) {
      console.log(err);
    },
    close: function() {
      Rails.ajax({
        url: "/experiences/<%= params[:experience_id] %>/events/<%=  params[:event_id] %>/bookings",
        dataType: "json",
        type: "POST",
        success: function(data) {
          window.location.href = `/bookings/${data.booking_id}`
        },
        error: function(data) {
          console.log(data.errors)
        }
      })
    }
});

// Obs.: é necessário passar os valores boolean como string
checkout.open({
  amount: 8000,
  buttonText: 'Pagar',
  buttonClass: 'botao-pagamento',
  customerData: 'false',
  createToken: 'true',
  paymentMethods: 'credit_card',
  customer: {
    external_id: '#123456789',
    name: 'Fulano',
    type: 'individual',
    country: 'br',
    email: 'fulano@email.com',
    documents: [
      {
        type: 'cpf',
        number: '71404665560',
      },
    ],
    phone_numbers: ['+5511999998888', '+5511888889999'],
    birthday: '1985-01-01'
  }
});
});


var checkout = new PagarMeCheckout.Checkout({
  encryption_key: "ENCRYPTION_KEY",
  success: function(data) {
    console.log(data);
  },
  error: function(err) {
    console.log(err);
  },
  close: function() {
    console.log('The modal has been closed');
  }
});
